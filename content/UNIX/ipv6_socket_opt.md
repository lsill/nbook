---
title: "Ipv6套接字选项"
date: 2023-12-26T16:19:25+08:00
draft: true
---

getsockopt和setsockopt函数的第二个参数，IPPROTO_IPV6。

## IPV6_CHECKSUM 套接字选项
本选项指定用户数据中校验和所处位置的字节偏移。如果该值为非负，那么内核将:
(i)给所有外出分组计算并存储校验和；
(ii)验证外来分组的校验和，丢弃所有校验和无效的分组。本选项影响除ICMPV6原始套接字以外的所有IPV6原始套接字。
(内核总是给ICMPv6原始套接字计算并存储校验和。)如果指定本选项的值为-1(默认值)，那么内核不会在相应的原始套
接字上计算并存储外出分组的校验和，也不会验证外来分组的校验和。

所有使用IPv6的协议在它们各自的协议首部都应该有一个校验和。这些校验和包含一个伪首部(pseudoheader),而伪首部
包括作为校验和一部分的源IPV6地址(这一点不同于通常使用IPv4原始套接字来实现的所有其他协议)。这样不必强求使用
原始套接字的应用进程进行源地址选择，而是由内核这么做，并由内核计算并存储包含标准IPV6份首部的检验和。

## IPV6_DONTFRAG 套接字选项
开启本选项将禁止为UDP套接字或原始套接字自动插入分片首部，外出分组中大小超过发送接口MTU的那些分组将被丢弃。
发送分组的系统调用不会为此返回错误，因为己发送出去仍在途中的分组也可能因为超过路径MTU而被丢弃。应用进程应该
开启IPV6_RECVPATHMTU选项以获悉路径MTU的变动。

## IPV6_NEXTHOP 套接字选项
本选项将外出数据报的下一跳地址指定为一个套接字地址结构。这是一个特权操作。

## IPV6_PATHMTU 套接字选项
本选项不能设置，只能获取。获取本选项时，返回值为由路径MTU发现功能确定的当前MTU。

## IPV6_RECVDSTOPTS 套接字选项
开启本选项表明，任何接收到的IPv6目的地选项都将由recvmsg作为辅助数据返回。本选项默认为关闭。

## IPV6_RECVHOPLIMIT 套接字选项
开启本选项表明，任何接收到的IPv6跳限选项都将由recvmsg作为辅助数据返回。本选项默认为关闭。

## IPV6_RECVHOPOPTS 套接字选项
开启本选项表明，任何接收到的IPv6步跳选项都将由recvmsg作为辅助数据返回。本选项默认为关闭。

## IPV6_RECVPATHMTU 套接字选项
开启本选项表明，某条路径的路径MTU在发生变化时将由recvmsg作为辅助数据返回(不伴随任何数据)。

## IPV6_RECVPKTINFO 套接字选项
开启本选项表明，接收到的IPv6数据报的以下两条信息将由recvmsg作为辅助数据返回: 目的IPv6地址和到达接口索引。

## IPV6_RECVRTHDR
开启本选项表明，接收到的IPv6路由首部将由recvmsg作为辅助数据返回。本选项默认为关闭。

## IPV6_RECVTCLASS 套接字选项
开启本选项表明，接收到的流通类别(包含DSCP和ECN字段)将由recvmsg作为辅助数据返回。本选项默认为关闭。

## IPV6_UNICAST_HOPS 套接字选项
本IPV6选项类似于IPv4的IP_TTL套接字选项。设置本选项会给在相应套接字上发送的外出数据报指定默认跳限，获取本
选项会返回内核用于相应套接字的跳限值。来自接收到的IPv6数据报中跳限字段的实际值通过使用IPV6_RECVHOPLTMIT
套接字选项取得。

## IPV6_USE_MIN_MTU 
把本选项设置为1表明，路径MTU发现功能不必执行，为避免分片，分组就使用IPv6的最小MTU发送。把本选项设置为0表明，
路径MTU发现功能对于所有目的地都得执行。把本选项设置为-1表明，路径MTU发现功能仅对单播目的地执行，对于多播目
的地就使用最小MTU。本选项默认值为-1。

## IPV6_V6ONLY
在一个AF_INET6套接字上开启本选项将限制它只执行IPv6通信。本选项默认为关闭，不过有些系统存在默认开启本选项的
手段。

## IPV6_XXX 套接字选项
大多数用于修改协议首部的IPv6选项假设:就UDP套接字而言，信息由recvmsg和sendmsg，作为辅助数据在内核和应用进程
之间传递:就TCP套接字而言，同样的信息改用getsockopt和setsockopt获取和设置。套接字选项和辅助数据的类型一致，
并且访问套接字选项的缓冲区所含的信息和辅助数据中存放的信息也一致。










