---
title: "TCP"
date: 2023-12-08T16:13:28+08:00
draft: true
---

# 1. TCP的状态
![](https://raw.githubusercontent.com/lsill/gitLink/main/document/photo/note/unix/tcptranstate.jpg)

## 1.1 为什么要有 TIME_WAIT状态
TIME_WAIT状态持续时间一般是MSL(maximum segment lifetime)的两倍

因为ip数据包有下一条限制（跳限），所以就有了tcp分组在网络中存在时间不可能超过MSL秒这个定义

- 可靠的实现TCP全双工连接的终止：因为超时重传机制，tcp连接断开时候，服务端可能需要重发一次FIN给
客户端，如果不存在一个类似的状态的话，客户端收到的FIN就无法正确处理全双工断开
- 允许老的重复分节在网络中消逝：tcp在同一ip和端口号重新开启了一个链接，因为TIME_WAIT状态最多持续2MSL，
上个链接发送的包就会消失，不会在发送到新的连接上。
# 2. TCP的MSS
MTU，全称“最大传输单元”（Maximum Transmission Unit），是指在一个网络层（如以太网或IP网络）上可以
传输的最大数据包大小。它是网络通信中的一个重要参数，因为它影响数据包的分段和效率。

- IP 层：IP 协议定义了数据包的 MTU。如果一个 IP 数据包大于 MTU，它将在网络层被分段。
- TCP 层：TCP 协议通过“最大报文段大小”（MSS）来处理 MTU 问题。MSS 通常比 MTU 小一些，
以留出空间给 IP 和 TCP 头部。 (MSS = MTU -IP头 - TCP头)
- 路径 MTU 发现：这是一种机制，用于确定两个网络节点之间的路径上的最小 MTU。它可以帮助优
化数据包大小，减少必要的分段。

## QA:
1. 如果tcp没收到来自对端的MSS选项，本段TCP就采用536这个值，为什么使用536？
- IP 数据包最小长度：在 TCP/IP 网络中，任何网络都必须能够传输至少 576 字节的 IP 数据包
（这包括 IP 头部和数据）。
- IP 头部大小：IP 头部的大小通常是 20 字节（不包含任何可选项）。
- TCP 头部大小：TCP 头部也通常是 20 字节（不包含任何选项）。

576 字节（最小IP数据包） - 20 字节（IP头部） - 20 字节（TCP头部） = 536 字节(MSS)

作用：
- 兼容性：使用 536 字节作为默认值可以提高在不同网络环境下的兼容性，特别是在早期的互联网中，
当网络设备和链路可能不支持较大数据包时。
- 无需分段：这个默认值可以减少因超过网络 MTU 而导致的 IP 分段，从而简化网络通信，减少潜在的性能问题。

在实际应用中，现代网络通常支持更大的 MTU 和 MSS 值，因此实际使用的 MSS 值通常大于 536 字节，
并且通常在 TCP 连接建立时通过 MSS 选项进行协商。



